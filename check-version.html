<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check Files Version</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
            background: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #8B7355, #A0826D);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .section {
            background: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            border-left: 4px solid #8B7355;
        }
        .file-check {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            margin: 5px 0;
            background: #f9f9f9;
            border-radius: 3px;
        }
        .status {
            padding: 3px 8px;
            border-radius: 3px;
            font-weight: bold;
            font-size: 12px;
        }
        .status.ok { background: #d4edda; color: #155724; }
        .status.fail { background: #f8d7da; color: #721c24; }
        .status.loading { background: #fff3cd; color: #856404; }
        button {
            background: #8B7355;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #6d5a43;
        }
        .info {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #2196F3;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            color: #c7254e;
        }
        .command {
            background: #2d2d2d;
            color: #00ff00;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîç Ki·ªÉm Tra Version Files</h1>
        <p>Tool n√†y ki·ªÉm tra xem c√°c file tr√™n VPS c√≥ ph·∫£i l√† version m·ªõi nh·∫•t kh√¥ng</p>
    </div>

    <div class="info">
        <strong>üìå Version hi·ªán t·∫°i:</strong> <code>1768918335</code><br>
        <strong>üìÖ Ng√†y:</strong> <span id="current-date"></span>
    </div>

    <div class="section">
        <h3>1. Ki·ªÉm Tra Files</h3>
        <button onclick="checkFiles()">üîÑ Ki·ªÉm Tra T·∫•t C·∫£ Files</button>
        <button onclick="location.reload()">‚ôªÔ∏è Reload Trang</button>
        <div id="results" style="margin-top: 15px;"></div>
    </div>

    <div class="section">
        <h3>2. Clear Cache Tr√¨nh Duy·ªát</h3>
        <p><strong>Chrome/Edge:</strong></p>
        <ul>
            <li>Nh·∫•n <code>Ctrl + Shift + Delete</code></li>
            <li>Ch·ªçn "Cached images and files"</li>
            <li>Click "Clear data"</li>
        </ul>
        <p><strong>Ho·∫∑c Hard Refresh:</strong></p>
        <ul>
            <li>Windows: <code>Ctrl + Shift + R</code> ho·∫∑c <code>Ctrl + F5</code></li>
            <li>Mac: <code>Cmd + Shift + R</code></li>
        </ul>
    </div>

    <div class="section">
        <h3>3. Clear Cache VPS (Apache)</h3>
        <p>Ch·∫°y c√°c l·ªánh n√†y tr√™n VPS:</p>
        <div class="command">
# Clear Apache cache (n·∫øu c√≥ mod_cache)<br>
sudo service apache2 restart<br>
<br>
# Ho·∫∑c clear PHP opcache (n·∫øu c√≥)<br>
sudo service php-fpm restart
        </div>
    </div>

    <div class="section">
        <h3>4. Ki·ªÉm Tra .htaccess</h3>
        <p>File <code>.htaccess</code> ph·∫£i c√≥ n·ªôi dung sau:</p>
        <div class="command">
&lt;FilesMatch "\.(css|js)$"&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Header set Cache-Control "max-age=0, no-cache"<br>
&lt;/FilesMatch&gt;
        </div>
        <button onclick="checkHtaccess()">Ki·ªÉm Tra .htaccess</button>
        <div id="htaccess-result"></div>
    </div>

    <script>
        // Show current date
        document.getElementById('current-date').textContent = new Date().toLocaleString('vi-VN');

        const files = [
            'css/main.css',
            'css/language.css',
            'css/responsive.css',
            'js/i18n.js',
            'js/translations-full.js',
            'js/main.js'
        ];

        async function checkFiles() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>ƒêang ki·ªÉm tra...</p>';

            let html = '';
            let allOk = true;

            for (const file of files) {
                html += `<div class="file-check">
                    <span>${file}</span>
                    <span class="status loading" id="status-${file.replace(/[/.]/g, '-')}">Checking...</span>
                </div>`;
            }

            resultsDiv.innerHTML = html;

            for (const file of files) {
                const statusId = `status-${file.replace(/[/.]/g, '-')}`;
                try {
                    // Add timestamp to force fresh check
                    const response = await fetch(`${file}?check=${Date.now()}`);
                    const statusEl = document.getElementById(statusId);

                    if (response.ok) {
                        const content = await response.text();
                        const size = (content.length / 1024).toFixed(2);
                        statusEl.textContent = `‚úÖ OK (${size} KB)`;
                        statusEl.className = 'status ok';
                    } else {
                        statusEl.textContent = `‚ùå Error ${response.status}`;
                        statusEl.className = 'status fail';
                        allOk = false;
                    }
                } catch (error) {
                    const statusEl = document.getElementById(statusId);
                    statusEl.textContent = `‚ùå Failed: ${error.message}`;
                    statusEl.className = 'status fail';
                    allOk = false;
                }
            }

            if (allOk) {
                resultsDiv.innerHTML += '<p style="color: green; font-weight: bold; margin-top: 15px;">‚úÖ T·∫•t c·∫£ files ƒë·ªÅu OK!</p>';
                resultsDiv.innerHTML += '<p>N·∫øu v·∫´n ch∆∞a ƒë√∫ng, h√£y hard refresh: <code>Ctrl + Shift + R</code></p>';
            } else {
                resultsDiv.innerHTML += '<p style="color: red; font-weight: bold; margin-top: 15px;">‚ùå C√≥ file b·ªã l·ªói! Ki·ªÉm tra l·∫°i vi·ªác upload.</p>';
            }
        }

        async function checkHtaccess() {
            const resultDiv = document.getElementById('htaccess-result');
            resultDiv.innerHTML = '<p>ƒêang ki·ªÉm tra...</p>';

            try {
                const response = await fetch('.htaccess?check=' + Date.now());
                if (response.ok) {
                    resultDiv.innerHTML = '<p style="color: green;">‚úÖ File .htaccess t·ªìn t·∫°i</p>';
                } else {
                    resultDiv.innerHTML = '<p style="color: red;">‚ùå File .htaccess kh√¥ng t·ªìn t·∫°i ho·∫∑c kh√¥ng truy c·∫≠p ƒë∆∞·ª£c</p>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<p style="color: orange;">‚ö†Ô∏è Kh√¥ng th·ªÉ ki·ªÉm tra .htaccess (c√≥ th·ªÉ b·ªã block)</p>';
            }
        }

        // Auto check on load
        window.addEventListener('load', () => {
            setTimeout(checkFiles, 500);
        });
    </script>
</body>
</html>
